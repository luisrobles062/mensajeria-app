{% extends "base.html" %}
{% block title %}Consultar Estado - CERTISERVI{% endblock %}
{% block content %}
<h2>Consultar Estado de Guías</h2>

<form action="/consultar_estado" method="POST" class="mt-4 mb-4">
    <div class="mb-3">
        <label for="guias" class="form-label">Ingrese números de guías (una por línea)</label>
        <textarea name="guias" id="guias" rows="6" class="form-control" placeholder="Ejemplo:&#10;12345&#10;67890" required></textarea>
    </div>
    <button type="submit" name="exportar" value="0" class="btn btn-primary">Consultar</button>
    <button type="submit" name="exportar" value="1" class="btn btn-success ms-2">Exportar a Excel</button>
    <a href="/" class="btn btn-secondary ms-2">Volver al Inicio</a>
</form>

{% if resultados is not none %}
<table class="table table-bordered table-hover">
    <thead>
        <tr>
            <th>Guía</th>
            <th>Estado</th>
            <th>Motivo</th>
            <th>Mensajero</th>
            <th>Zona</th>
            <th>Fecha de Despacho</th>
            <th>Gestión</th>
        </tr>
    </thead>
    <tbody>
        {% for r in resultados %}
        <tr>
            <td>{{ r.numero_guia }}</td>
            <td>{{ r.estado }}</td>
            <td>{{ r.motivo }}</td>
            <td>{{ r.mensajero }}</td>
            <td>{{ r.zona }}</td>
            <td>{% if r.fecha_despacho %}{{ r.fecha_despacho.strftime("%Y-%m-%d %H:%M:%S") }}{% endif %}</td>
            <td>{{ r.gestion }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}
{% endblock %}
